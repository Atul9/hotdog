# Example hotdog configuration
---
global:
  listen:
    address: '127.0.0.1'
    port: 6514
    tls:
      cert: './contrib/cert.pem'
      key: './contrib/cert-key.pem'
  kafka:
    brokers: '127.0.0.1:9092'
    # Default topic to log messages to that are not otherwise mapped
    topic: 'test'
  metrics:
    statsd: 'localhost:8125'

# Fields upon which rules can apply:
#   - severity
#   - facility
#   - timestamp
#   - hostname
#   - appname
#   - msg
rules:
  - regex: '^hello\s+(?P<name>\w+)?'
    field: msg
    actions:
      - type: replace
        template: |
          This is the total message: {{msg}}

          And the name is: {{name}}

      - type: forward
        topic: test

      # We don't want any other rules to try to consume these messages
      - type: stop

  # Match all JSON looking content
  - jmespath: 'meta.topic'
    field: msg
    # But don't do anything with it ^_^
    actions:
      - type: merge
        json:
          meta:
            hotdog:
              version: '{{version}}'
              timestamp: '{{iso8601}}'

      - type: forward
        topic: '{{value}}'

      - type: stop

  # Catch-all, send everything else to a "logs-unknown" topic
  - regex: '.*'
    field: msg
    actions:
      - type: forward
        topic: 'logs-unknown'

      - type: stop
